#!/usr/bin/env node
/**
 * Generate 32x32 pixel art sprites for village villagers
 * Creates RPG-style pixel art compatible with VillageCanvas
 */

import { createCanvas } from '@napi-rs/canvas';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const SPRITE_SIZE = 32;
const OUTPUT_DIR = path.join(__dirname, '../public/assets/village/villagers');

// Pixel art sprites defined as arrays (each row is 32 pixels, using palette indices)
// 0 = transparent, 1+ = palette color

const PALETTES = {
  merchant: {
    1: '#212121', // outline
    2: '#4CAF50', // green apron
    3: '#2E7D32', // dark green
    4: '#8D6E63', // brown vest
    5: '#5D4037', // dark brown (hair)
    6: '#FFCCBC', // skin
    7: '#FFB3AB', // skin shadow
    8: '#FFD54F', // gold
    9: '#FFFFFF', // white
  },
  baker: {
    1: '#212121', // outline
    2: '#FFFFFF', // white (hat/apron)
    3: '#E0E0E0', // light gray
    4: '#F8BBD9', // pink dress
    5: '#EC407A', // dark pink
    6: '#FFAB91', // skin
    7: '#FF8A65', // skin shadow
    8: '#BF360C', // auburn hair
    9: '#8D4004', // dark hair
  },
  banker: {
    1: '#212121', // outline
    2: '#1A237E', // navy suit
    3: '#0D1440', // dark navy
    4: '#FFD54F', // gold
    5: '#9E9E9E', // gray hair
    6: '#757575', // dark gray
    7: '#FFCCBC', // skin
    8: '#FFB3AB', // skin shadow
    9: '#FFFFFF', // white shirt
  },
  farmer: {
    1: '#212121', // outline
    2: '#1976D2', // blue overalls
    3: '#1565C0', // dark blue
    4: '#FDD835', // straw hat
    5: '#F9A825', // dark straw
    6: '#D7A478', // tanned skin
    7: '#C08552', // skin shadow
    8: '#FF7043', // orange plaid
    9: '#5D4037', // brown hair
  },
  blacksmith: {
    1: '#212121', // outline
    2: '#795548', // leather apron
    3: '#5D4037', // dark leather
    4: '#FF6F00', // orange glow
    5: '#E65100', // dark orange
    6: '#BCAAA4', // pale skin
    7: '#A1887F', // skin shadow
    8: '#616161', // metal
    9: '#424242', // dark metal
  },
  traveler: {
    1: '#212121', // outline
    2: '#7B1FA2', // purple cloak
    3: '#4A148C', // dark purple
    4: '#1565C0', // blue accent
    5: '#0D47A1', // dark blue
    6: '#FFCCBC', // skin
    7: '#FFB3AB', // skin shadow
    8: '#FFD54F', // gold (staff gem)
    9: '#311B92', // dark purple hair
  },
  elder: {
    1: '#212121', // outline
    2: '#90CAF9', // light blue robe
    3: '#64B5F6', // medium blue
    4: '#FFFFFF', // white trim
    5: '#BDBDBD', // gray hair
    6: '#9E9E9E', // dark gray
    7: '#FFCCBC', // skin
    8: '#FFB3AB', // skin shadow
    9: '#8D6E63', // cane
  }
};

// Sprite patterns - each character has a unique look
// Row by row, 0=transparent, numbers=palette color
const SPRITES = {
  merchant: [
    '00000000000000000000000000000000',
    '00000000000111111110000000000000',
    '00000000011555555551100000000000',
    '00000000115555555555110000000000',
    '00000000155555555555510000000000',
    '00000001555555555555551000000000',
    '00000001555555555555551000000000',
    '00000011666666666666661100000000',
    '00000116611666661166666110000000',
    '00000166111666661116666610000000',
    '00000166666666666666666610000000',
    '00000016666666776666666100000000',
    '00000001666666666666661000000000',
    '00000000166666666666610000000000',
    '00000000011666666661100000000000',
    '00000001112222222222111000000000',
    '00000012222222222222222100000000',
    '00000122222233332222222210000000',
    '00000122222233332222222210000000',
    '00066122222233332222222216600000',
    '00066122222233332222222216600000',
    '00006122222233332222222216000000',
    '00000122222222222222222210000000',
    '00000012222222222222222100000000',
    '00000001222222222222221000000000',
    '00000000122211112222100000000000',
    '00000000122100001221000000000000',
    '00000000122100001221000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000000000000000000000000000',
  ],
  baker: [
    '00000000000222222220000000000000',
    '00000000022222222222200000000000',
    '00000000222222222222220000000000',
    '00000000222223322222220000000000',
    '00000000111111111111110000000000',
    '00000000188888888888810000000000',
    '00000001888888888888881000000000',
    '00000018866666666666881000000000',
    '00000016611666661166661000000000',
    '00000016111666661116661000000000',
    '00000016666666666666661000000000',
    '00000001666666556666610000000000',
    '00000000166666666666100000000000',
    '00000000016666666661000000000000',
    '00000000001166666110000000000000',
    '00000000012444444421000000000000',
    '00000000124444444444210000000000',
    '00000001244422224444421000000000',
    '00000012444222224444442100000000',
    '00006612444222224444442166000000',
    '00006612444222224444442166000000',
    '00000612444222224444442160000000',
    '00000012444444444444442100000000',
    '00000001244444444444421000000000',
    '00000000124444444444210000000000',
    '00000000012441114442100000000000',
    '00000000012410001421000000000000',
    '00000000012410001421000000000000',
    '00000000011110001111000000000000',
    '00000000011110001111000000000000',
    '00000000011110001111000000000000',
    '00000000000000000000000000000000',
  ],
  banker: [
    '00000000000000000000000000000000',
    '00000000000111111110000000000000',
    '00000000011555555551100000000000',
    '00000000115555555555110000000000',
    '00000000155555655555510000000000',
    '00000001555555655555551000000000',
    '00000001555555555555551000000000',
    '00000011777777777777771100000000',
    '00000117711777771177777110000000',
    '00000177181777771817777710000000',
    '00000177777777777777777710000000',
    '00000017777777887777777100000000',
    '00000001777777777777771000000000',
    '00000000177777777777710000000000',
    '00000000011777777771100000000000',
    '00000001119999999991110000000000',
    '00000012222222222222221000000000',
    '00000122222224222222222100000000',
    '00000122222244422222222100000000',
    '00077122222244422222222177000000',
    '00077122222244422222222177000000',
    '00007122222244422222222170000000',
    '00000122222222222222222100000000',
    '00000012222222222222221000000000',
    '00000001222222222222210000000000',
    '00000000122211112222100000000000',
    '00000000122100001221000000000000',
    '00000000122100001221000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000000000000000000000000000',
  ],
  farmer: [
    '00000000044444444444400000000000',
    '00000000444444444444440000000000',
    '00000004444455554444444000000000',
    '00000044444455554444444400000000',
    '00000000111111111111110000000000',
    '00000001999999999999991000000000',
    '00000019999999999999999100000000',
    '00000016666666666666661000000000',
    '00000166611666661166666100000000',
    '00000166111666661116666100000000',
    '00000166666666666666666100000000',
    '00000016666666776666661000000000',
    '00000001666666666666610000000000',
    '00000000166666666666100000000000',
    '00000000011666666661100000000000',
    '00000001118888888881110000000000',
    '00000012222222222222221000000000',
    '00000122222223322222222100000000',
    '00000122222233332222222100000000',
    '00066122222233332222222166000000',
    '00066122222233332222222166000000',
    '00006122222233332222222160000000',
    '00000122222222222222222100000000',
    '00000012222222222222221000000000',
    '00000001222222222222210000000000',
    '00000000122211112222100000000000',
    '00000000122100001221000000000000',
    '00000000122100001221000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000000000000000000000000000',
  ],
  blacksmith: [
    '00000000000000000000000000000000',
    '00000000000111111110000000000000',
    '00000000011111111111100000000000',
    '00000000111111111111110000000000',
    '00000001111111111111111000000000',
    '00000001111111111111111000000000',
    '00000001111111111111111000000000',
    '00000011666666666666661100000000',
    '00000116611666661166666110000000',
    '00000166111666661116666610000000',
    '00000166666666666666666610000000',
    '00000016666666776666666100000000',
    '00000001666666666666661000000000',
    '00000000166666666666610000000000',
    '00000000011666666661100000000000',
    '00000001112222222222111000000000',
    '00000012222222222222222100000000',
    '00000122222233332222222210000000',
    '00000122222233332222222210000000',
    '00066122222233332222222216600000',
    '00066122222233332222222216600000',
    '00088122222233332222222218800000',
    '00000122222222222222222210000000',
    '00000012222222222222222100000000',
    '00000001222222222222221000000000',
    '00000000122211112222100000000000',
    '00000000122100001221000000000000',
    '00000000122100001221000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000000000000000000000000000',
  ],
  traveler: [
    '00000000000333333330000000000000',
    '00000000033333333333300000000000',
    '00000000333333333333330000000000',
    '00000000333999999993330000000000',
    '00000003339999999999333000000000',
    '00000003399999999999933000000000',
    '00000003999999999999993000000000',
    '00000033666666666666663300000000',
    '00000366611666661166666330000000',
    '00000366111666661116666330000000',
    '00000366666666666666666330000000',
    '00000036666666776666663300000000',
    '00000003666666666666633000000000',
    '00000000366666666666300000000000',
    '00000000033666666633000000000000',
    '00000000322222222222230000000000',
    '00000003222222222222223000000000',
    '00000032222224442222223300000000',
    '00000032222244444222223300000000',
    '00066332222244444222233366000000',
    '00066332222244444222233366000000',
    '00006332222244444222233360000000',
    '00000032222222222222223300000000',
    '00000003222222222222230000000000',
    '00000000322222222222300000000000',
    '00000000032221112223000000000000',
    '00000000032210001223000000000000',
    '00000000032210001223000000000000',
    '00000000033310001333000000000000',
    '00000000033310001333000000000000',
    '00000000033310001333000000000000',
    '00000000000000000000000000000000',
  ],
  elder: [
    '00000000000000000000000000000000',
    '00000000000111111110000000000000',
    '00000000011555555551100000000000',
    '00000000115555555555110000000000',
    '00000000155555555555510000000000',
    '00000001555555555555551000000000',
    '00000001555555555555551000000000',
    '00000011777777777777771100000000',
    '00000117711777771177777110000000',
    '00000177111777771117777710000000',
    '00000177777777777777777710000000',
    '00000017777777887777777100000000',
    '00000001777777777777771000000000',
    '00000000177777777777710000000000',
    '00000000011777777771100000000000',
    '00000001112222222222111000000000',
    '00000012222222222222222100000000',
    '00000122222244442222222210000000',
    '00000122222244442222222210000000',
    '00077122222244442222222217700000',
    '00077122222244442222222217700000',
    '09907122222244442222222217099000',
    '09900122222222222222222210099000',
    '09900012222222222222221000990000',
    '00900001222222222222210009000000',
    '00000000122211112222100000000000',
    '00000000122100001221000000000000',
    '00000000122100001221000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000111100001111000000000000',
    '00000000000000000000000000000000',
  ],
};

function hexToRgba(hex) {
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  return { r, g, b, a: 255 };
}

async function generateSprite(name) {
  const canvas = createCanvas(SPRITE_SIZE, SPRITE_SIZE);
  const ctx = canvas.getContext('2d');
  
  // Clear with transparency
  ctx.clearRect(0, 0, SPRITE_SIZE, SPRITE_SIZE);
  
  const palette = PALETTES[name];
  const sprite = SPRITES[name];
  
  if (!palette || !sprite) {
    console.error(`Missing data for ${name}`);
    return;
  }
  
  // Draw each pixel
  for (let y = 0; y < SPRITE_SIZE; y++) {
    const row = sprite[y] || '';
    for (let x = 0; x < SPRITE_SIZE; x++) {
      const colorIndex = row[x] || '0';
      if (colorIndex !== '0') {
        const color = palette[parseInt(colorIndex)];
        if (color) {
          ctx.fillStyle = color;
          ctx.fillRect(x, y, 1, 1);
        }
      }
    }
  }
  
  // Save
  const outputPath = path.join(OUTPUT_DIR, `${name}.png`);
  const buffer = canvas.toBuffer('image/png');
  fs.writeFileSync(outputPath, buffer);
  console.log(`âœ… Generated: ${name}.png (${buffer.length} bytes)`);
}

async function main() {
  console.log('ðŸŽ¨ Generating village sprites...\n');
  
  // Ensure output directory exists
  if (!fs.existsSync(OUTPUT_DIR)) {
    fs.mkdirSync(OUTPUT_DIR, { recursive: true });
  }
  
  // Generate each villager sprite
  for (const name of Object.keys(SPRITES)) {
    await generateSprite(name);
  }
  
  console.log('\nâœ¨ All sprites generated!');
}

main().catch(console.error);
